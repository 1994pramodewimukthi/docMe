<!doctype html>
<html class="fixed sidebar-left-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- start: header -->
    <!--/*/ <th:block th:include="/fragments/header/resources :: resources"></th:block> /*/-->
    <!-- end: header -->

    <link rel="stylesheet" th:href="@{/vendor/sweet-alert/sweetalert2.min.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/airpicker/dist/css/datepicker.min.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/dropify-master/dist/css/dropify.min.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/dropzone/basic.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/dropzone/dropzone.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/form-validation/css/formValidation.min.css}">
    <meta name="context-path" th:content="@{/}"/>

</head>
<body class="loading-overlay-showing" data-loading-overlay id="loginBody">
<div class="loading-overlay">
    <div class="bounce-loader">
        <h3 class="loadHeading mb-5">L O A D I N G</h3>
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
</div>
<section class="body mt-3 mb-3">
    <input id="pdfData" name="pdfData" th:value="${mcgPdfDto.pdfFile}" type="hidden">
    <div class="text-center" id='pdf-viewer'></div>
</section>

<!--start: footer-->
<!--/*/ <th:block th:include="/fragments/footer/footer :: footer"></th:block> /*/-->
<!--end: footer-->
<script th:src="@{/js/pdf.js}" type="text/javascript"></script>
<script>
    var CONTEXT_PATH = $('meta[name=context-path]').attr("content");
    CONTEXT_PATH = CONTEXT_PATH.substr(0, CONTEXT_PATH.length - 1);
</script>
<script type="text/javascript">
    var pdfData = atob($("#pdfData").val());
    var pdfjsLib = window['pdfjs-dist/build/pdf'];
    if (pdfData.toString().trim() !== "") {
        pdfjsLib.GlobalWorkerOptions.workerSrc = CONTEXT_PATH + '/js/pdf.worker.js';
        var thePdf = null;
        var scale = 1.3;
        $(document).ready(function () {
            pdfjsLib.getDocument({data: pdfData}, false, null, function (progress) {
                var percent_loaded = (progress.loaded / progress.total) * 100;
                console.log(percent_loaded);
            }).promise.then(function (pdf) {
                thePdf = pdf;

                viewer = document.getElementById('pdf-viewer');
                for (page = 1; page <= pdf.numPages; page++) {
                    canvas = document.createElement("canvas");
                    br = document.createElement("br");
                    canvas.className = 'pdf-page-canvas';
                    viewer.appendChild(canvas);
                    viewer.appendChild(br);
                    renderPage(page, canvas);
                }
            });

        });
    } else {
        swal({
            title: 'Error',
            text: 'Not valid pdf.',
            type: 'error',
            showConfirmButton: true,
            allowOutsideClick: false
        }).then(function () {
            window.close();
        });
    }

    function renderPage(pageNumber, canvas) {
        thePdf.getPage(pageNumber).then(function (page) {
            viewport = page.getViewport(scale);
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            page.render({canvasContext: canvas.getContext('2d'), viewport: viewport});
        });
    }

</script>
</body>
</html>
